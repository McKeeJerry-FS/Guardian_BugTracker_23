@model Guardian_BugTracker_23.Models.Project
@inject IBTFileService _fileService
@inject IBTProjectService _projectService
@inject UserManager<BTUser> _userManager

@{
    BTUser? user = await _userManager.GetUserAsync(User);
    
    List<Project?> projects = await _projectService.GetAllProjectsByCompanyIdAsync(user.CompanyId);        
    
}

<div class="content web-app">

    <div class="row no-gutters app-block">
        <div class="col-md-3 app-sidebar">
            <button class="btn btn-primary btn-block file-upload-btn mb-3" data-toggle="modal"
                    data-target="#compose">
                Upload Files
            </button>
            <form class="d-none" id="file-upload">
                <input type="file" multiple>
            </form>
            <div class="app-sidebar-menu">
                <div>
                    <div class="list-group list-group-flush">
                        <a href="" class="list-group-item active d-flex align-items-center">
                            <i class="ti-folder mr-2 list-group-icon"></i>All Files
                            <span class="small ml-auto">45</span>
                        </a>
                        <a href="" class="list-group-item">
                            <i class="ti-desktop mr-2 list-group-icon"></i>My Devices
                        </a>
                        <a href="" class="list-group-item">
                            <i class="ti-upload mr-2 list-group-icon"></i>Recents
                        </a>
                        <a href="" class="list-group-item d-flex align-items-center">
                            <i class="ti-star mr-2 list-group-icon"></i>Important
                            <span class="small ml-auto">10</span>
                        </a>
                        <a href="" class="list-group-item">
                            <i class="ti-trash mr-2 list-group-icon"></i>Deleted Files
                        </a>
                    </div>
                </div>
                <p class="mt-4 font-weight-bold">Storage Status</p>
                <div class="d-flex align-items-center">
                    <div class="mr-3">
                        <i data-feather="database" class="width-30 height-30"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="progress" style="height: 10px">
                            <div class="progress-bar progress-bar-striped" role="progressbar"
                                 style="width: 40%" aria-valuenow="10" aria-valuemin="0"
                                 aria-valuemax="100"></div>
                        </div>
                        <div class="line-height-12 small text-muted mt-2">19.5GB used of 25GB</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9 app-content">
            <h3 class="mb-4">File Manager</h3>
            <div class="app-action">
                <div class="action-left">
                    <ul class="list-inline">
                        <li class="list-inline-item mb-0">
                            <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown">
                                <i data-feather="plus" class="mr-1"></i>
                                Add
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#">Folder</a>
                                <a class="dropdown-item" href="#">File</a>
                            </div>
                        </li>
                        <li class="list-inline-item mb-0">
                            <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown">Folders</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item d-flex justify-content-between" href="#">
                                    Video
                                    <span class="text-muted">21</span>
                                </a>
                                <a class="dropdown-item d-flex justify-content-between" href="#">
                                    Image
                                    <span class="text-muted">5</span>
                                </a>
                                <a class="dropdown-item d-flex justify-content-between" href="#">
                                    Audio
                                    <span class="text-muted">12</span>
                                </a>
                                <a class="dropdown-item d-flex justify-content-between" href="#">
                                    Documents
                                    <span class="text-muted">7</span>
                                </a>
                            </div>
                        </li>
                        <li class="list-inline-item mb-0">
                            <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown">
                                Order by
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#">Date</a>
                                <a class="dropdown-item" href="#">Name</a>
                                <a class="dropdown-item" href="#">Size</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="action-right">
                    <form class="d-flex">
                        <a href="#" class="app-sidebar-menu-button btn btn-outline-light">
                            <i data-feather="menu"></i>
                        </a>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search files"
                                   aria-describedby="button-addon1">
                            <div class="input-group-append">
                                <button class="btn btn-outline-light" type="button" id="button-addon1">
                                    <i data-feather="search"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <h5 class="mb-4">Folders</h5>

            <div class="row">
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <div class="card app-file-list">
                        <div class="app-file-icon">
                            <i class="fa fa-file-text-o text-danger"></i>
                            <div class="dropdown position-absolute top-0 right-0 mr-3">
                                <a href="#" class="btn btn-floating btn-sm" data-toggle="dropdown">
                                    <i class="ti-more-alt"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" class="dropdown-item">View Details</a>
                                    <a href="#" class="dropdown-item">Share</a>
                                    <a href="#" class="dropdown-item">Download</a>
                                    <a href="#" class="dropdown-item">Copy to</a>
                                    <a href="#" class="dropdown-item">Move to</a>
                                    <a href="#" class="dropdown-item">Rename</a>
                                    <a href="#" class="dropdown-item">Delete</a>
                                </div>
                            </div>
                        </div>
                        <div class="p-3 small">
                            <a href="#" class="d-block mb-1">Documents</a>
                            <div class="text-muted mb-1">10 folders and 100 files</div>
                            <div class="text-muted">5.90 GB</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <div class="card app-file-list">
                        <div class="app-file-icon">
                            <i class="fa fa-refresh text-secondary"></i>
                            <div class="dropdown position-absolute top-0 right-0 mr-3">
                                <a href="#" class="btn btn-floating btn-sm" data-toggle="dropdown">
                                    <i class="ti-more-alt"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" class="dropdown-item">View Details</a>
                                    <a href="#" class="dropdown-item">Share</a>
                                    <a href="#" class="dropdown-item">Download</a>
                                    <a href="#" class="dropdown-item">Copy to</a>
                                    <a href="#" class="dropdown-item">Move to</a>
                                    <a href="#" class="dropdown-item">Rename</a>
                                    <a href="#" class="dropdown-item">Delete</a>
                                </div>
                            </div>
                        </div>
                        <div class="p-3 small">
                            <a href="#" class="d-block mb-1">Backup</a>
                            <div class="text-muted mb-1">5 folders and 312 files</div>
                            <div class="text-muted">16.38 GB</div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <div class="card app-file-list">
                        <div class="app-file-icon">
                            <i class="fa fa-file-text-o text-warning"></i>
                            <div class="dropdown position-absolute top-0 right-0 mr-3">
                                <a href="#" class="btn btn-floating btn-sm" data-toggle="dropdown">
                                    <i class="ti-more-alt"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" class="dropdown-item">View Details</a>
                                    <a href="#" class="dropdown-item">Share</a>
                                    <a href="#" class="dropdown-item">Download</a>
                                    <a href="#" class="dropdown-item">Copy to</a>
                                    <a href="#" class="dropdown-item">Move to</a>
                                    <a href="#" class="dropdown-item">Rename</a>
                                    <a href="#" class="dropdown-item">Delete</a>
                                </div>
                            </div>
                        </div>
                        <div class="p-3 small">
                            <a href="#" class="d-block mb-1">Other Files</a>
                            <div class="text-muted mb-1">25 files</div>
                            <div class="text-muted">805 MB</div>
                        </div>
                    </div>
                </div>
            </div>
            <h5 class="mb-4">Recent Files</h5>
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>File Name</th>
                                    <th>File Type</th>
                                    <th>Description</th>
                                    <th>Created Date</th>
                                    <th>Members</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach(Project? project in projects){
                                    foreach(Ticket? ticket in project?.Tickets!)
                                    {
                                        foreach (TicketAttachment? attachment in ticket.Attachments)
                                        {
                                            <tr>
                                                <td>@attachment.FileName</td>
                                                <td>@attachment.FileType</td>
                                                <td>@attachment.Description</td>
                                                <td>@attachment.Created</td>
                                                <td>@attachment.BTUser!.FullName</td>
                                            </tr>
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
